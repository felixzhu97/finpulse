@startuml c4-containers-zh
!define RELATIVE_INCLUDE 1
!include ../../c4-lib/C4-PlantUML/C4_Container.puml

title FinPulse 金融科技平台 - 容器（模块）图

Person(investor, "投资者", "投资组合与市场分析")

System_Boundary(finpulse, "FinPulse") {
    Boundary(frontend_boundary, "前端应用") {
        Container(web_app, "Web 应用", "Angular 21", "金融分析控制台：投资组合、市场趋势、风险、交易")
        Container(mobile_portfolio, "移动端投资组合", "Expo + React Native", "投资组合应用：股票、实时行情、原生图表。整洁架构：展示层 → 应用层 → 领域层 ← 基础设施层")
    }
    
    Boundary(backend_boundary, "后端服务") {
        Container(portfolio_api, "投资组合分析 API", "FastAPI", "Clean Architecture：composition.py、container、crud_helpers。REST、WebSocket；AI/ML；区块链；投资组合、市场数据；批量 VaR、ClickHouse、MLflow")
        Container(portfolio_api_go, "投资组合 API (Go)", "Gin", "非 AI：health、GET /api/v1/quotes、GET /api/v1/instruments；DDD（domain、application、infrastructure）；Swagger；共享 DB")
    }
    
    Boundary(data_boundary, "数据存储") {
        ContainerDb(timescale, "TimescaleDB", "PostgreSQL + TimescaleDB", "投资组合元数据与历史超表")
        ContainerDb(redis, "Redis", "内存", "历史、组合聚合、区块链读缓存")
        ContainerDb(clickhouse, "ClickHouse", "OLAP", "portfolio_risk_daily、delta_table_stats；API 读取")
        Container(minio, "MinIO", "S3 兼容", "数据湖；Faust 写入行情批次；Spark/Delta")
    }
    
    Boundary(messaging_boundary, "消息队列") {
        ContainerQueue(kafka, "Kafka", "事件流", "portfolio.events, market.quotes.enriched")
    }
}

Container_Ext(market_api, "市场数据 API", "外部", "第三方市场数据")
Container_Ext(vercel, "Vercel", "托管", "Web 部署与分析")

Rel(investor, web_app, "使用", "HTTPS")
Rel(investor, mobile_portfolio, "使用", "HTTPS / WebSocket")
Rel(web_app, portfolio_api, "API 调用", "REST / WebSocket")
Rel(mobile_portfolio, portfolio_api, "API 调用", "REST / WebSocket")
Rel(portfolio_api, timescale, "读写", "SQL / asyncpg")
Rel(portfolio_api, redis, "缓存", "Redis 协议")
Rel(portfolio_api, kafka, "发布与消费", "Kafka")
Rel(portfolio_api, clickhouse, "读取分析", "HTTP")
Rel(portfolio_api, minio, "批任务写入", "S3")
Rel(portfolio_api, market_api, "获取行情", "REST")
Rel(portfolio_api_go, timescale, "读取", "SQL / pgx")
Rel(web_app, portfolio_api_go, "API 调用（可选）", "REST")
Rel(mobile_portfolio, portfolio_api_go, "API 调用（可选）", "REST")
Rel(web_app, vercel, "托管于", "Vercel")

LAYOUT_TOP_DOWN()

@enduml
