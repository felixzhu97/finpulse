@startuml c4-mobile-portfolio-components-zh
!define RELATIVE_INCLUDE 1
!include ../../c4-lib/C4-PlantUML/C4_Component.puml

title 移动端投资组合应用 - 组件图

Container_Boundary(mobile_portfolio, "移动端投资组合 (Expo + React Native)") {
    Component(tabs_router, "标签路由", "Expo Router", "仪表盘、自选、洞察、个人")
    Component(dashboard_screen, "仪表盘屏幕", "React Native", "组合摘要、原生图表、净资产、资产配置")
    Component(watchlist_screen, "自选屏幕", "React Native", "股票列表（组合）、底部搜索、排序、详情抽屉")
    Component(insights_screen, "洞察屏幕", "React Native", "风险指标、服务端 risk-metrics API")
    Component(profile_screen, "个人屏幕", "React Native", "用户偏好 via API")

    Component(types_layer, "types", "TypeScript", "Portfolio、QuoteSnapshot、Instrument 等")
    Component(api_client, "portfolioApi", "TypeScript", "GET portfolio 缓存、getAccounts、getRiskSummary、seedPortfolio")
    Component(quotes_rest, "getQuotes", "TypeScript", "GET /api/v1/quotes")
    Component(quote_socket, "createQuoteSocket", "TypeScript", "WebSocket /ws/quotes、订阅、重连")
    Component(rest_apis, "customersApi, userPreferencesApi, riskMetricsApi", "TypeScript", "Profile、Insights 用 REST")

    Component(redux_quotes, "Redux quotes slice", "Redux Toolkit", "quotes、history、subscribedSymbols、setSnapshot、setStatus")
    Component(quote_subscriber, "QuoteSocketSubscriber", "React Native", "读取 subscribedSymbols、运行 WebSocket、派发到 store")
    Component(portfolio_store, "组合 Store", "自定义", "当前选中账户 id（UI）")

    Component(use_symbol_display, "useSymbolDisplayData", "Hook", "setSubscribedSymbols、从 Redux 选择；bySymbol、quoteMap、historyBySymbol")
    Component(use_portfolio, "usePortfolio", "Hook", "portfolio + allocation + history + refresh")
    Component(use_draggable_drawer, "useDraggableDrawer", "Hook", "底部抽屉滑动手画")
    Component(use_user_prefs, "useUserPreferences", "Hook", "个人偏好")
    Component(use_risk_metrics, "useRiskMetrics", "Hook", "洞察 risk-metrics API")

    Component(portfolio_summary, "PortfolioSummary", "React Native", "净资产、当日变动")
    Component(asset_allocation_chart, "AssetAllocationChart", "React Native", "按账户类型饼图")
    Component(net_worth_chart, "NetWorthLineChart", "React Native", "净资产趋势")
    Component(account_list_item, "AccountListItem", "React Native", "账户行")
    Component(stock_list_item, "StockListItem", "React Native", "持仓行、价格、迷你图、打开详情抽屉")
    Component(metric_card, "MetricCard", "React Native", "标签、数值、说明")
    Component(native_sparkline, "NativeSparkline", "原生视图", "每股迷你图")
    Component(native_line_chart, "NativeLineChart", "原生视图", "Metal / OpenGL ES")
    Component(stock_detail_drawer, "StockDetailDrawer", "React Native", "可拖拽抽屉、实时价/图、分享")
    Component(sort_menu, "SortMenu", "React Native", "按名称、价格、涨跌、涨跌幅排序")
    Component(glass_search_bar, "底部搜索栏", "React Native", "GlassView，点击搜索图标打开，抽屉/排序/切 tab 时关闭")
    Component(glass_view, "GlassView", "React Native", "expo-blur，Liquid Glass 用于搜索栏与标签栏")

    Component(api_config, "API Config", "TypeScript", "EXPO_PUBLIC_PORTFOLIO_API_URL、Base URL")
}

Container_Ext(portfolio_api, "投资组合分析 API", "REST / WebSocket", "组合、/ws/quotes、risk-metrics")

Rel(tabs_router, dashboard_screen, "路由到", "")
Rel(tabs_router, watchlist_screen, "路由到", "")
Rel(tabs_router, insights_screen, "路由到", "")
Rel(tabs_router, profile_screen, "路由到", "")

Rel(dashboard_screen, use_portfolio, "使用", "")
Rel(use_portfolio, api_client, "调用", "")
Rel(dashboard_screen, portfolio_summary, "使用", "")
Rel(dashboard_screen, asset_allocation_chart, "使用", "")
Rel(dashboard_screen, net_worth_chart, "使用", "")
Rel(dashboard_screen, native_line_chart, "使用", "")
Rel(dashboard_screen, portfolio_store, "读取", "")

Rel(watchlist_screen, api_client, "调用", "getPortfolio")
Rel(watchlist_screen, use_symbol_display, "使用", "")
Rel(watchlist_screen, stock_list_item, "使用", "")
Rel(watchlist_screen, account_list_item, "使用", "")
Rel(watchlist_screen, stock_detail_drawer, "使用", "")
Rel(watchlist_screen, sort_menu, "使用", "")
Rel(watchlist_screen, glass_search_bar, "使用", "")
Rel(glass_search_bar, glass_view, "使用", "")

Rel(use_symbol_display, redux_quotes, "派发、选择", "")
Rel(quote_subscriber, redux_quotes, "派发 setSnapshot", "")
Rel(quote_subscriber, quote_socket, "创建", "")
Rel(quote_socket, portfolio_api, "WebSocket", "/ws/quotes")

Rel(insights_screen, api_client, "调用", "getRiskSummary")
Rel(insights_screen, use_risk_metrics, "使用", "")
Rel(use_risk_metrics, rest_apis, "调用", "risk-metrics")
Rel(insights_screen, metric_card, "使用", "")

Rel(profile_screen, use_user_prefs, "使用", "")
Rel(use_user_prefs, rest_apis, "调用", "user-preferences")

Rel(stock_detail_drawer, use_draggable_drawer, "使用", "")
Rel(stock_list_item, native_sparkline, "使用", "")

Rel(api_client, api_config, "使用", "Base URL")
Rel(api_client, portfolio_api, "HTTP", "GET /api/v1/portfolio")
Rel(rest_apis, api_config, "使用", "")
Rel(rest_apis, portfolio_api, "HTTP", "REST")
Rel(quotes_rest, api_config, "使用", "")
Rel(quotes_rest, portfolio_api, "HTTP", "GET /api/v1/quotes")
Rel(api_client, types_layer, "使用", "")
Rel(quote_socket, types_layer, "使用", "")

@enduml
